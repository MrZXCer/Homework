<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="database.mapper.CreatorMapper">

    <sql id="createPlan">
        create table if not exists plan (
            `planId` int primary key auto_increment,
            `name` varchar(30),
            `cost` decimal(11,3),
            `callMinutes` int,
            `callExceedingCost` decimal(11,3),
            `sms` int,
            `smsExceedingCost` decimal(11,3),
            `localData` float,
            `localDataExceedingCost` decimal(11,3),
            `domesticData` float,
            `domesticDataExceedingCost` decimal(11,3)
        );
    </sql>
    <sql id="createUser">
        create table if not exists user (
            `userId` int primary key auto_increment,
            `name` varchar(30)
        );
    </sql>
    <sql id="createUserPlan">
        create table if not exists userplan (
            `userId` int,
            `planId` int,
            `activateTime` datetime,
            `orderTime` datetime
        );
    </sql>
    <sql id="createUserPlanTransaction">
        create table if not exists userplantransaction (
            `transactionId` int primary key auto_increment,
            `userId` int,
            `planId` int,
            `time` datetime,
            `action` enum('ORDER_IMMEDIATELY', 'ORDER_NEXT_MONTH', 'CANCEL')
        );
    </sql>
    <sql id="createDataUsage">
        create table if not exists datausage (
            `userId` int,
            `dataType` enum('LOCAL','DOMESTIC'),
            `quantity` float,
            `startTime` datetime,
            `endTime` datetime
        );
    </sql>
    <sql id="createCallUsage">
      create table if not exists callusage (
          `userId` int,
          `quantity` int,
          `startTime` datetime,
          `endTime` datetime
      );
    </sql>
    <sql id="createBasicCost">
        create table if not exists basiccost (
            `id` int primary key auto_increment,
            `callCost` decimal(11,3),
            `smsCost` decimal(11,3),
            `localDataCost` decimal(11, 3),
            `domesticDataCost` decimal(11, 3),
            `activateTime` datetime
        );
    </sql>
    <insert id="insertBasicCost">
      insert into basiccost(callCost, smsCost, localDataCost, domesticDataCost, activateTime) VALUES (0.5, 0.1, 2, 5, now());
    </insert>
    <insert id="createAllTables">
        <include refid="createPlan"/>
        <include refid="createUser"/>
        <include refid="createUserPlan"/>
        <include refid="createUserPlanTransaction"/>
        <include refid="createDataUsage"/>
        <include refid="createCallUsage"/>
        <include refid="createBasicCost"/>
    </insert>

    <insert id="insertAPlan">
        insert into plan(name, cost, callMinutes, callExceedingCost, sms, smsExceedingCost, localData, localDataExceedingCost, domesticData, domesticDataExceedingCost) VALUE ('测试套餐', 20, 100, 0.5, NULL, NULL, NULL, NULL, NULL, NULL);
    </insert>

    <insert id="insertAUser">
        insert into user(name) VALUES ('测试用户1');
    </insert>

    <delete id="dropAllTables">
        drop table plan, user, userplan, userplantransaction, datausage, callusage, basiccost;
    </delete>
</mapper>